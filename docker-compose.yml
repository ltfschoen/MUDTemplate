# https://github.com/compose-spec/compose-spec/blob/master/spec.md
version: "3.8"
services:
  foundry:
    container_name: foundry
    image: foundry:latest
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 2
        window: 120s
      resources:
        limits:
          cpus: '0.75'
          memory: 750M
        reservations:
          cpus: '0.125'
          memory: 125M
    # restart: always
    build:
      context: "."
      dockerfile: ./docker/Dockerfile
    volumes:
      - ./:/opt
    ports:
      # https://stackoverflow.com/questions/67974976/docker-compose-not-exposing-ports
      # https://docs.docker.com/engine/reference/commandline/run/#publish
      # - "127.0.0.1:8545:8545"
      # - "127.0.0.1:3000:3000"
      - "0.0.0.0:8545:8545"
      - "0.0.0.0:3000:3000"
      # - "8545:8545"
      # - "3000:3000"
      # - "443:443"
      # - "80:80"

    # expose all ports from docker container
    # but this option is only supported on Linux
    # "The host networking driver only works on Linux hosts,
    # and is not supported on Docker Desktop for Mac, Docker Desktop for Windows,
    # or Docker EE for Windows Server." - @Grasume from Discord Docker https://discord.gg/8egGEFjc
    # network_mode: host
    env_file:
      - .env
